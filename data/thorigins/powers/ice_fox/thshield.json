{
	"type": "origins:multiple",
	"name": { "translate": "ice_fox.thshield.name" },
	"description": { "translate": "ice_fox.thshield.description" },
	"badges": [
		{
			"type": "origins:tooltip",
			"text": {
				"translate": "thshield.key",
				"with": [
					{
						"keybind": "key.saveToolbarActivator",
						"color": "aqua"
					},
					{
						"keybind": "key.sneak",
						"color": "aqua"
					},
					{
						"keybind": "key.pickItem",
						"color": "aqua"
					}
				]
			},
			"sprite": "origins:textures/gui/badge/star.png"
		},
		{
			"type": "origins:tooltip",
			"text": {
				"translate": "thshield.info"
			},
			"sprite": "origins:textures/gui/badge/arrow_up.png"
		}
	],

	"_init_": {
		"type": "origins:action_on_callback",
		"entity_action_added": {
			"type": "origins:execute_command",
			"command": "/scoreboard objectives add ice_shield_owner_uuid0 dummy \"Ice Shield Owner UUID[0]\""
		}
	},

	"ticks_20": {
		"type": "origins:action_over_time",
		"entity_action": {
			"type": "origins:and",
			"actions": [
				{
					"type": "origins:if_else",
					"condition": {
						"type": "origins:resource",
						"resource": "*:*_hold_timer",
						"compare_to": 0,
						"comparison": "=="
					},
					"if_action": {
						"type": "origins:change_resource",
						"resource": "*:*_shield_charge_timer",
						"change": -10
					}
				},
				{
					"type": "origins:if_else",
					"condition": {
						"type": "origins:power_active",
						"power": "*:*_switch",
						"inverted": true
					},
					"if_action": {
						"type": "origins:change_resource",
						"resource": "*:*_sensing_timer",
						"change": -20
					}
				}
			]
		}
	},

	"exchange_shard_to_shield": {
		"type": "origins:active_self",
		"key": {
			"key": "key.saveToolbarActivator",
			"continuous": true
		},
		"entity_action": {
			"type": "origins:if_else",
			"condition": {
				"type": "origins:resource",
				"resource": "*:*_shield_charge_timer",
				"compare_to": 10,
				"comparison": "<"
			},
			"if_action": {
				"type": "origins:if_else",
				"condition": {
					"type": "origins:or",
					"conditions": [
						{
							"type": "origins:power",
							"power": "*:ice_fox/ice_shield",
							"inverted": true
						},
						{
							"type": "origins:resource",
							"resource": "*:ice_fox/ice_shield_shield_count",
							"compare_to": 5,
							"comparison": "<"
						}
					]
				},
				"if_action": {
					"type": "origins:and",
					"actions": [
						{
							"type": "origins:change_resource",
							"resource": "*:*_shield_charge_timer",
							"change": 1
						},
						{
							"type": "origins:trigger_cooldown",
							"power": "*:*_hold_timer"
						}
					]
				}
			},
			"else_action": {
				"type": "origins:and",
				"actions": [
					{
						"type": "origins:change_resource",
						"resource": "*:*_shield_charge_timer",
						"change": 0,
						"operation": "set"
					},
					{
						"type": "origins:if_else",
						"condition": {
							"type": "origins:power",
							"power": "*:ice_fox/ice_shield"
						},
						"if_action": {
							"type": "origins:if_else",
							"condition": {
								"type": "origins:resource",
								"resource": "*:ice_fox/ice_shield_shield_count",
								"compare_to": 5,
								"comparison": "<"
							},
							"if_action": {
								"type": "origins:and",
								"actions": [
									{
										"type": "origins:change_resource",
										"resource": "*:ice_fox/thicicyle_awoo",
										"change": -3
									},
									{
										"type": "origins:change_resource",
										"resource": "*:ice_fox/ice_shield_change_shield_count",
										"change": 1
									},
									{
										"type": "origins:execute_command",
										"command": "/execute store result score @s ice_shield_owner_uuid0 run data get entity @s UUID[0] 1"
									}
								]
							}
						},
						"else_action": {
							"type": "origins:and",
							"actions": [
								{
									"type": "origins:change_resource",
									"resource": "*:ice_fox/thicicyle_awoo",
									"change": -3
								},
								{
									"type": "origins:execute_command",
									"command": "/title @s actionbar {\"text\":\"\",\"extra\":[{\"translate\":\"ice_shield.granted_by_self\"}]}"
								},
								{
									"type": "origins:play_sound",
									"sound": "minecraft:block.beacon.activate",
									"category": "players",
									"pitch": 1.9,
									"volume": 0.7
								},
								{
									"type": "origins:grant_power",
									"power": "*:ice_fox/ice_shield",
									"source": "thorigins:temp"
								},
								{
									"type": "origins:execute_command",
									"command": "/execute store result score @s ice_shield_owner_uuid0 run data get entity @s UUID[0] 1"
								}
							]
						}
					}
				]
			}
		},
		"condition": {
			"type": "origins:and",
			"conditions": [
				{
					"type": "origins:moving",
					"inverted": true
				},
				{
					"type": "origins:resource",
					"resource": "*:ice_fox/thicicyle_awoo",
					"compare_to": 3,
					"comparison": ">="
				}
			]
		}
	},

	"grant_shield": {
		"type": "origins:action_on_entity_use",
		"bientity_condition": {
			"type": "origins:target_condition",
			"condition": {
				"type": "origins:living"
			}
		},
		"bientity_action": {
			"type": "origins:if_else",
			"condition": {
				"type": "origins:actor_condition",
				"condition": {
					"type": "origins:resource",
					"resource": "*:*_shield_charge_timer",
					"compare_to": 10,
					"comparison": "<"
				}
			},
			"if_action": {
				"type": "origins:if_else",
				"condition": {
					"type": "origins:or",
					"conditions": [
						{
							"type": "origins:target_condition",
							"condition": {
								"type": "origins:power",
								"power": "*:ice_fox/ice_shield",
								"inverted": true
							}
						},
						{
							"type": "origins:target_condition",
							"condition": {
								"type": "origins:resource",
								"resource": "*:ice_fox/ice_shield_shield_count",
								"compare_to": 5,
								"comparison": "<"
							}
						}
					]
				},
				"if_action": {
					"type": "origins:actor_action",
					"action": {
						"type": "origins:and",
						"actions": [
							{
								"type": "origins:change_resource",
								"resource": "*:*_shield_charge_timer",
								"change": 4
							},
							{
								"type": "origins:trigger_cooldown",
								"power": "*:*_hold_timer"
							}
						]
					}
				}
			},
			"else_action": {
				"type": "origins:and",
				"actions": [
					{
						"type": "origins:actor_action",
						"action": {
							"type": "origins:execute_command",
							"command": "/tag @s add temp"
						}
					},
					{
						"type": "origins:actor_action",
						"action": {
							"type": "origins:change_resource",
							"resource": "*:*_shield_charge_timer",
							"change": 0,
							"operation": "set"
						}
					},
					{
						"type": "origins:if_else",
						"condition": {
							"type": "origins:target_condition",
							"condition": {
								"type": "origins:power",
								"power": "*:ice_fox/ice_shield"
							}
						},
						"if_action": {
							"type": "origins:if_else",
							"condition": {
								"type": "origins:target_condition",
								"condition": {
									"type": "origins:resource",
									"resource": "*:ice_fox/ice_shield_shield_count",
									"compare_to": 5,
									"comparison": "<"
								}
							},
							"if_action": {
								"type": "origins:and",
								"actions": [
									{
										"type": "origins:actor_action",
										"action": {
											"type": "origins:change_resource",
											"resource": "*:ice_fox/thicicyle_awoo",
											"change": -3
										}
									},
									{
										"type": "origins:target_action",
										"action": {
											"type": "origins:change_resource",
											"resource": "*:ice_fox/ice_shield_change_shield_count",
											"change": 1
										}
									},
									{
										"type": "origins:target_action",
										"action": {
											"type": "origins:execute_command",
											"command": "/execute store result score @s ice_shield_owner_uuid0 run data get entity @p[tag=temp] UUID[0] 1"
										}
									}
								]
							}
						},
						"else_action": {
							"type": "origins:and",
							"actions": [
								{
									"type": "origins:actor_action",
									"action": {
										"type": "origins:change_resource",
										"resource": "*:ice_fox/thicicyle_awoo",
										"change": -3
									}
								},
								{
									"type": "origins:target_action",
									"action": {
										"type": "origins:and",
										"actions": [
											{
												"type": "origins:play_sound",
												"sound": "minecraft:block.beacon.activate",
												"category": "players",
												"pitch": 1.9,
												"volume": 0.7
											},
											{
												"type": "origins:grant_power",
												"power": "*:ice_fox/ice_shield",
												"source": "thorigins:temp"
											},
											{
												"type": "origins:execute_command",
												"command": "/execute store result score @s ice_shield_owner_uuid0 run data get entity @p[tag=temp] UUID[0] 1"
											}
										]
									}
								},
								{
									"type": "origins:target_action",
									"action": {
										"type": "origins:execute_command",
										"command": "/title @s actionbar {\"text\":\"\",\"extra\":[{\"translate\":\"ice_shield.granted_by_fox\",\"fallback\":\"§bThe Ice fox used magic to cover your body with hardened ice, granting you §eextra defence\"}]}"
									}
								},
								{
									"type": "origins:actor_action",
									"action": {
										"type": "origins:execute_command",
										"command": "/tag @s remove temp"
									}
								}
							]
						}
					}
				]
			}
		},
		"condition": {
			"type": "origins:and",
			"conditions": [
				{
					"type": "origins:moving",
					"inverted": true
				},
				{
					"type": "origins:resource",
					"resource": "*:ice_fox/thicicyle_awoo",
					"compare_to": 3,
					"comparison": ">="
				},
				{
					"type": "origins:equipped_item",
					"item_condition": {
						"type": "origins:empty"
					},
					"equipment_slot": "mainhand"
				}
			]
		}
	},

	"shield_charge_timer": {
		"type": "origins:resource",
		"min": 0,
		"max": 10,
		"hud_render": {
			"should_render": true,
			"sprite_location": "origins:textures/gui/community/spiderkolo/resource_bar_03.png",
			"bar_index": 0,
			"condition": {
				"type": "origins:resource",
				"resource": "*:*_shield_charge_timer",
				"compare_to": 0,
				"comparison": ">"
			}
		}
	},

	"hold_timer": {
		"type": "origins:cooldown",
		"cooldown": 3
	},

	"sensing_timer": {
		"type": "origins:resource",
		"min": 0,
		"max": 20,
		"max_action": {
			"type": "origins:execute_command",
			"command": "/playsound minecraft:block.beacon.activate player @s ~ ~ ~ 0.6 1.7"
		},
		"hud_render": {
			"should_render": true,
			"sprite_location": "origins:textures/gui/community/spiderkolo/resource_bar_02.png",
			"bar_index": 7,
			"condition": {
				"type": "origins:resource",
				"resource": "*:*_sensing_timer",
				"compare_to": 0,
				"comparison": ">"
			}
		}
	},

	"double_tap_check_window": {
		"type": "origins:cooldown",
		"cooldown": 5
	},

	"switch": {
		"type": "origins:toggle",
		"key": "nuh.uh",
		"active_by_default": false,
		"retain_state": false,
		"condition": {
			"type": "origins:sneaking"
		}
	},

	"sneak": {
		"type": "origins:active_self",
		"key": "key.sneak",
		"entity_action": {
			"type": "origins:if_else",
			"condition": {
				"type": "origins:resource",
				"resource": "*:*_double_tap_check_window",
				"compare_to": 0,
				"comparison": "=="
			},
			"if_action": {
				"type": "origins:trigger_cooldown",
				"power": "*:*_double_tap_check_window"
			},
			"else_action": {
				"type": "origins:toggle",
				"power": "*:*_switch"
			}
		}
	},

	"charge_up": {
		"type": "origins:active_self",
		"key": {
			"key": "key.sneak",
			"continuous": true
		},
		"entity_action": {
			"type": "origins:change_resource",
			"resource": "*:*_sensing_timer",
			"change": 1
		},
		"condition": {
			"type": "origins:power_active",
			"power": "*:*_switch"
		}
	},

	"screen_effect": {
		"type": "origins:shader",
		"shader": "minecraft:shaders/post/invert.json",
		"condition": {
			"type": "origins:and",
			"conditions": [
				{
					"type": "origins:power_active",
					"power": "*:*_switch"
				},
				{
					"type": "origins:resource",
					"resource": "*:*_sensing_timer",
					"compare_to": 20,
					"comparison": "=="
				}
			]
		}
	},

	"sensing_mobs": {
		"type": "origins:entity_glow",
		"bientity_condition": {
			"type": "origins:and",
			"conditions": [
				{
					"type": "origins:target_condition",
					"condition": {
						"type": "origins:living"
					}
				},
				{
					"type": "origins:distance",
					"compare_to": 50,
					"comparison": "<="
				},
				{
					"type": "origins:target_condition",
					"inverted": true,
					"condition": {
						"type": "origins:or",
						"conditions": [
							{
								"type": "origins:power",
								"power": "*:ice_fox/icicyle"
							},
							{
								"type": "origins:power",
								"power": "*:ice_fox/ice_shield"
							}
						]
					}
				}
			]
		},
		"condition": {
			"type": "origins:power_active",
			"power": "*:*_screen_effect"
		}
	},

	"sensing_detonatable": {
		"type": "origins:entity_glow",
		"blue": 0.0,
		"red": 0.8,
		"green": 0.8,
		"use_teams": false,
		"bientity_condition": {
			"type": "origins:and",
			"conditions": [
				{
					"type": "origins:distance",
					"compare_to": 50,
					"comparison": "<="
				},
				{
					"type": "origins:target_condition",
					"condition": {
						"type": "origins:or",
						"conditions": [
							{
								"type": "origins:power",
								"power": "*:ice_fox/icicyle"
							},
							{
								"type": "origins:power",
								"power": "*:ice_fox/ice_shield"
							}
						]
					}
				}
			]
		},
		"condition": {
			"type": "origins:power_active",
			"power": "*:*_screen_effect"
		}
	},

	"detonate": {
		"type": "origins:active_self",
		"key": "key.pickItem",
		"cooldown": 10,
		"entity_action": {
			"type": "origins:and",
			"actions": [
				{
					"type": "origins:toggle",
					"power": "*:*_switch"
				},
				{
					"type": "origins:spawn_particles",
					"particle": "minecraft:note",
					"offset_y": 1,
					"spread": {
						"x": 0.1,
						"y": 0.1,
						"z": 0.1
					},
					"speed": 0,
					"count": 3
				},
				{
					"type": "origins:play_sound",
					"sound": "minecraft:entity.fox.screech",
					"category": "players",
					"pitch": 1.5,
					"volume": 1.5
				},
				{
					"type": "origins:delay",
					"ticks": 1,
					"action": {
						"type": "origins:play_sound",
						"sound": "minecraft:block.amethyst_block.resonate",
						"category": "players",
						"pitch": 1.8,
						"volume": 1.2
					}
				},
				{
					"type": "origins:execute_command",
					"command": "/tag @s add temp"
				},
				{
					"type": "origins:execute_command",
					"command": "/execute as @e[tag=shield_carrier,distance=..50] if score @s ice_shield_owner_uuid0 = @e[tag=temp,limit=1,sort=nearest] UUID0 run resource set @s thorigins:ice_fox/ice_shield_detonating 1"
				},
				{
					"type": "origins:execute_command",
					"command": "/tag @s remove temp"
				}
			]
		},
		"condition": {
			"type": "origins:power_active",
			"power": "*:*_screen_effect"
		}
	}
}
